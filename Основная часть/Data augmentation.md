Аугментация позволяет увеличить объем исходного количества изображений за счет их изменений: поворот, растягивание/сжатие, изменение цветов и т.д.

Попробуем создать нейронную сеть на изображениях символов MRZ. Машинно-читаемой зоной (MRZ — Machine-Readable Zone) называют часть документа, удостоверяющего личность, выполненную согласно международным рекомендациям, закрепленным в [документе Doc 9303 — Machine Readable Travel Documents Международной Организации Гражданской Авиации](http://www.icao.int/publications/pages/publication.aspx?docnum=9303). Подробнее про проблемы распознавания MRZ можно прочитать в [другой нашей статье](http://habrahabr.ru/company/smartengines/blog/259649/).  
  
Пример MRZ:  
![](https://habrastorage.org/r/w1560/files/a8a/f31/c8e/a8af31c8e6dc4f5fa0539238005ebde3.png)  
  
MRZ содержит 88 символов. Будем использовать 2 характеристики качества работы системы:  

- процент ошибочно распознанных символов.
- процент полностью правильно распознанных зон (MRZ считается полностью правильно распознанной, если все символы в ней распознаны правильно).

  
В дальнейшем нейронную сеть предполагается использовать на мобильных устройствах, где вычислительные мощности ограничены, поэтому используемые сетки будут иметь относительно небольшое число слоев и весов.  
Для экспериментов было собрано 800'000 примеров символов, которые были разбиты на 3 группы: 200'000 примеров на обучение, 300'000 примеров на валидацию и 300'000 примеров на тестирование. Подобное разбиение неестественно, поскольку большая часть примеров “пропадает впустую” (валидация и тестирование), но позволяет наилучшим образом показать преимущества и недостатки различных методов.  
Для тестовой выборки распределение примеров различных классов близко к реальному и выглядит следующим образом:  
Название класса (символ): число примеров  
0: 22416 1: 17602 2: 13746 3: 8115 4: 8587 5: 9383 6: 8697 7: 8082 8: 9734 9: 8847  
<: 110438 A: 12022 B: 1834 C: 3891 D: 2952 E: 7349 F: 3282 G: 2169 H: 3309 I: 6737  
J: 934 K: 2702 L: 4989 M: 6244 N: 7897 O: 4515 P: 4944 Q: 109 R: 7717 S: 5499 T: 3730  
U: 4224 V: 3117 W: 744 X: 331 Y: 1834 Z: 1246  
  
При обучении только на естественных примерах средняя посимвольная величина ошибки по 25 экспериментам составила 0,25%, т.е. общее число неправильно распознанных символов составило 750 изображений из 300000. Для практического применения подобное качество неприемлемо, поскольку число правильно распознанных зон в таком случае составляет 80%.  
  
Рассмотрим наиболее частые типы ошибок, которые совершает нейронная сеть.  
Примеры неправильно распознанных изображений:  
![](https://habrastorage.org/r/w1560/files/acc/a0b/687/acca0b687d7647b2a94263f72614655a.png) ![](https://habrastorage.org/r/w1560/files/97c/41f/b34/97c41fb3445e4369954a06391ad7b70e.png) ![](https://habrastorage.org/r/w1560/files/ef5/dbf/717/ef5dbf7177654bc682c7d33e8cccd1b4.png) ![](https://habrastorage.org/r/w1560/files/77d/e59/a31/77de59a314984ec9b154b59058fae07e.png) ![](https://habrastorage.org/r/w1560/files/c14/2e0/248/c142e024853c4e1d940a2e5528261ea9.png) ![](https://habrastorage.org/r/w1560/files/632/6f3/943/6326f394353d4b5ea7b4ae2791d94868.png) ![](https://habrastorage.org/r/w1560/files/5e2/ccd/8f9/5e2ccd8f9c164d3eb418348e090adcb1.png) ![](https://habrastorage.org/r/w1560/files/d78/0ef/0eb/d780ef0eb5e9406484f249033f391d6f.png) ![](https://habrastorage.org/r/w1560/files/4fa/e6d/79a/4fae6d79aae945f1b7b2e164b040c0c5.png) ![](https://habrastorage.org/r/w1560/files/0d0/86f/ce0/0d086fce0ed44badaedba4f4b1616d64.png) ![](https://habrastorage.org/r/w1560/files/ca0/c72/2ed/ca0c722ed4d648c69f64845393400eb0.png) ![](https://habrastorage.org/r/w1560/files/1ef/b03/23e/1efb0323ec644d9fa932288d0cb870bd.png) ![](https://habrastorage.org/r/w1560/files/eef/4b0/488/eef4b0488e8f4f939a83aaaefc063ad5.png) ![](https://habrastorage.org/r/w1560/files/7e8/b21/409/7e8b2140966248bf8661cf4421c896f6.png) ![](https://habrastorage.org/r/w1560/files/eb1/01c/47a/eb101c47a8de4c2e8b8ca7cc61f4ffad.png) ![](https://habrastorage.org/r/w1560/files/b61/7c3/6de/b617c36deba743b4959775e293269cda.png) ![](https://habrastorage.org/r/w1560/files/d7d/503/c85/d7d503c85a00450080a3ae732c0f4d8c.png) ![](https://habrastorage.org/r/w1560/files/f7e/6f0/a94/f7e6f0a945cf4342a9d317b289cec88f.png)  
  
Можно выделить следующие типы ошибок:  

- Ошибки на нецентрированных изображениях.
- Ошибки на повернутых изображениях.
- Ошибки на изображениях с линиями.
- Ошибки на изображениях с бликами.
- Ошибки в сложных случаях.

  
Таблица наиболее частых ошибок:  
(формат Оригинальный символ, число ошибок, с какими символами сеть чаще всего путает данный символ и сколько раз)  
Оригинальный символ: ’0’, число ошибок: 437  
’O’: 419, ’U’: 5, ’J’: 4, ’2’: 2, ’1’: 1  
Оригинальный символ: ’<’, число ошибок: 71  
’2’: 29, ’K’: 6, ’P’: 6, ’4’: 4, ’6’: 4  
Оригинальный символ: ’8’, число ошибок: 35  
’B’: 10, ’6’: 10, ’D’: 4, ’E’: 2, ’M’: 2  
Оригинальный символ: ’O’, число ошибок: 20  
’0’: 19, ’Q’: 1  
Оригинальный символ: ’4’, число ошибок: 19  
’6’: 5, ’N’: 3, ’¡’: 2, ’A’: 1, ’D’: 1  
Оригинальный символ: ’6’, число ошибок: 18  
’G’: 4, ’S’: 4, ’D’: 3, ’O’: 2, ’4’: 2  
Оригинальный символ: ’1’, число ошибок: 17  
’T’: 6, ’Y’: 5, ’7’: 2, ’3’: 1, ’6’: 1  
Оригинальный символ: ’L’, число ошибок: 14  
’I’: 9, ’4’: 4, ’C’: 1  
Оригинальный символ: ’M’, число ошибок: 14  
’H’: 7, ’P’: 5, ’3’: 1, ’N’: 1  
Оригинальный символ: ’E’, число ошибок: 14  
’C’: 5, ’I’: 3, ’B’: 2, ’F’: 2, ’A’: 1  
  
Будем постепенно добавлять различные виды искажений, соответствующие наиболее распространенным типам ошибок, в обучающую выборку. Число добавленных «искаженных» изображений необходимо варьировать и подбирать, основываясь на обратном отклике валидационной выборки.  
  
Действуем по следующей схеме:  

![](https://habrastorage.org/r/w1560/files/7f5/1b2/912/7f51b291260847648bc9960b55dc25c9.png)

  
Например, для данной задачи было сделано следующее:  

1. Добавление искажения типа “сдвиг”, соответствующего ошибке на “нецентрированных” изображения.
2. Проведение серии экспериментов: обучение нескольких нейронных сетей.
3. Оценка качества на тестовой выборке. Качество распознавания MRZ увеличилось на 9%.
4. Анализ наиболее частых ошибок распознавания на валидационной выборке.
5. Добавление изображений с дополнительными линиями в обучающую базу.
6. Снова проведение серии экспериментов.
7. Тестирование. Качество распознавания MRZ на тестовой выборке возросло на 3.5%.

  
Подобные “итерации” можно проводить многократно — до достижения необходимого качества или до тех пор, пока качество не перестает расти.  
Таким способом, было получено качество распознавания в 94,5% правильно распознанных зон. Используя постобработку (марковские модели, конечные автоматы, N-граммные и словарные методы и т.д.), можно получить дальнейшее увеличения качества.  
  
При использовании обучения только на искусственных данных в рассматриваемой задаче удалось достичь только качества в 81,72% правильно распознанных зон, при этом основная проблема — сложность подбора параметров искажений.  

|Тип данных для обучения|Процент правильно распознанных MRZ|Посимвольная ошибка|
|---|---|---|
|Естественные изображения|80,78%|0,253%|
|Естественные изображения + изображения со сдвигами|89,68%|0.13%|
|+изображения с дополнительными линиями|93,19%|0.1%|
|+повернутые изображения|95,50%|0.055%|
|Искусственные изображения|78,53%|0.29%|